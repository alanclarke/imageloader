/*! Imageloader - v0.1.3 - 2013-02-07
* https://github.com/alanclarke/imageloader
* Copyright (c) 2013 alan clarke; Licensed MIT, GPL */
(function(a){function b(a,b){var c=this;c.img=new Image,c.img.src=a;if(c.img.complete)return!b||b(null,c.img);c.img.onload=function(){return c.img.width<1?!b||b(!0,c.img):!b||b(null,c.img)},c.img.onerror=function(){return!b||b(!0,c.img)}}function c(a){var b=this;b.opts=a,b.next=0;var c=typeof b.opts.async=="number"?b.opts.async:b.opts.async?b.opts.images.length:1;for(var d=0;d<c;d++)b.loadImg(b.opts.images[d],d)}c.prototype.loadImg=function(a,c){var d=this;d.next++,setTimeout(function(){d.opts.start&&d.opts.start(a,c),new b(a.src,function(a,b){d.complete(a,b,c)})},1)},c.prototype.complete=function(a,b,c){var d=this;d.opts.complete&&d.opts.complete(a,b,c),(!d.opts.async||typeof d.opts.async=="number")&&d.next<d.opts.images.length&&d.loadImg(d.opts.images[d.next],d.next)},a.fn.imageloader=function(b){var d=this,e=0,f=0,g=new a.Deferred;return d.$images=[],d.images=[],d.opts=a.extend(!0,{},{async:!0},b),a.each(d,function(b,c){c=a(c);if(c.is("img"))d.$images.push(c),d.images.push(c[0]);else{c=c.find("img");for(var e=0;e<c.length;e++)d.$images.push(a(c[e])),d.images.push(c[e])}}),new c({images:d.images,async:d.opts.async,start:function(a,b){d.opts.start&&d.opts.start({i:b,img:d.$images[b],loaded:e,errored:f,images:d.$images})},complete:function(a,b,c){var h={i:c,img:d.$images[c],err:!!a,loaded:++e,errored:a?++f:f,images:d.$images};g.notifyWith(d,[h]),a?d.opts.error&&d.opts.error(h):d.opts.complete&&d.opts.complete(h);if(e===d.images.length)return delete h.img,delete h.err,g.resolveWith(d,[h]),!d.opts.allcomplete||d.opts.allcomplete(h)}}),g.allcomplete=g.done,g.complete=g.progress,g}})(jQuery);